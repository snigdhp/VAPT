# A2:2017 Недостатки аутентификации

| Источники угроз/Векторы атак | Недостатки безопасности           | Последствия               |
| -- | -- | -- |
| Зависит от прил. : Сложность эксплуатации 3 | Распространенность 2 : Сложность обнаружения 2 | Технические 3 : Для бизнеса ? |
| Злоумышленники имеют доступ к сотням тысяч действительных комбинаций имен и паролей для атак на учетные записи, спискам стандартных учетных данных администраторов, инструментам для автоматизации атак методом подбора и атак по словарям. Атаки на сессии хорошо изучены, особенно в части действующих токенов сессий. | Недостатки аутентификации очень распространены из-за исполнения и реализации большинства средств идентификации и контроля доступа. Управление сессиями является основой аутентификации и контроля доступа и присутствует во всех приложениях с контролем состояния. Атакующие могут обнаружить недостатки аутентификации вручную и эксплуатировать их, используя автоматизированные инструменты, списки паролей и атаки по словарю. | Для компрометации системы злоумышленнику достаточно получить доступ к нескольким обычным или одной администраторской учетной записи. В зависимости от области использования приложения результатом может стать отмывание денег, мошенничество в сфере социального обеспечения или кража персональных данных, а также разглашение охраняемой законом, конфиденциальной информации. |

## Является ли приложение уязвимым?

Подтверждение личности пользователя, аутентификация и управление сессиями играют важную роль в защите от атак, связанных с аутентификацией.

Приложение имеет недостатки в аутентификации, если:

* допускается проведение автоматизированных атак, например, [на учетные записи](https://www.owasp.org/index.php/Credential_stuffing), когда у атакующего есть список действующих имен и паролей пользователей;
* допускается проведение атак методом подбора или других автоматизированных атак;
* допускается использование стандартных, ненадежных или хорошо известных паролей, например "Password1" или "admin/admin“;
* используются ненадежные или неэффективные методы восстановления учетных данных и паролей, например "ответы на основе знаний", которые являются небезопасными;
* используются незашифрованные, зашифрованные или ненадежно хешированные пароли (см. [A3: 2017-Разглашение конфиденциальных данных](0xa3-sensitive-data-disclosure.md));
* отсутствует или является неэффективной многофакторная аутентификация;
* отображаются идентификаторы сессии в URL (например, перезапись URL);
* не меняются идентификаторы сессий после успешного входа в систему;
* некорректно аннулируются идентификаторы сессий. Пользовательские сессии или токены аутентификации (в частности, токены единого входа (SSO)) неправильно аннулируются при выходе из системы или бездействии.

## Как предотвратить

* Где это возможно, реализуйте многофакторную аутентификацию для предотвращения автоматизированных атак, атак на учетные записи и методом подбора, а также повторного использования украденных учетных данных.
* Не используйте создаваемые по умолчанию (стандартные) учетные данные, особенно для администраторов.
* Реализуйте проверку надежности паролей, например проверяя вновь создаваемые или изменяемые пароли по списку ["10000 наихудших паролей"](https://github.com/danielmiessler/SecLists/tree/master/Passwords).
* Установите длину, сложность и периодичность смены паролей в соответствии с [руководством NIST 800-63 B (раздел 5.1.1 "Запоминаемые секреты")](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecret) или любой другой современной парольной политикой.
* Обеспечьте защиту регистрации, восстановления учетных данных и API от атак методом перечисления, используя во всех ответах одинаковые сообщения.
* Ограничьте или значительно увеличьте интервал между неудачными попытками входа. Регистрируйте все неудачные попытки и уведомляйте администраторов при обнаружении атак на учетные данные, методом подбора или любых других атак.
* Используйте менеджеры сессий на стороне сервера, надежные, встроенные, генерирующие после входа в систему новые, случайные идентификаторы с высокой степенью энтропии. Идентификаторы сессий не должны присутствовать в URL, а должны безопасно храниться и аннулироваться после выхода из системы, простоя или наступления абсолютного тайм-аута.

## Примеры сценариев атак

**Сценарий №1**: [Атака на учетные записи](https://www.owasp.org/index.php/Credential_stuffing), с использованием [списков известных паролей](https://github.com/danielmiessler/SecLists), является очень распространенной. Если в приложении нет защиты от автоматизированных атак или атак на учетные записи, то оно может быть использовано для определения действующих учетных данных.

**Сценарий №2**: Большинство атак на аутентификацию связано с использованием исключительно паролей. Ранее считавшиеся хорошими требования к смене пароля и его сложности способствуют использованию и переиспользованию пользователями ненадежных паролей. Организациям рекомендуется отказаться от подобной практики (см. NIST 800-63) и внедрить многофакторную аутентификацию.

**Сценарий №3**: Тайм-ауты сессий настроены некорректно. Люди используют общедоступные компьютеры для доступа к приложению, а вместо "выхода из приложения" просто закрывают вкладку и уходят. Злоумышленник может открыть тот же самый браузер спустя час и воспользоваться все еще действующей аутентификацией пользователя.

## Ссылки

### OWASP

* [Проактивная защита OWASP: реализация защиты идентификационных данных и аутентификации](https://www.owasp.org/index.php/OWASP_Proactive_Controls#5:_Implement_Identity_and_Authentication_Controls)
* [Стандарт подтверждения безопасности приложений OWASP (ASVS): V2 Аутентификация](https://www.owasp.org/index.php/Category:OWASP_Application_Security_Verification_Standard_Project#tab=Home)
* [Стандарт подтверждения безопасности приложений OWASP (ASVS): V3 Управление сессиями](https://www.owasp.org/index.php/Category:OWASP_Application_Security_Verification_Standard_Project#tab=Home)
* [Руководство OWASP по тестированию: Идентификационные данные](https://www.owasp.org/index.php/Testing_Identity_Management)
 и [Аутентификация](https://www.owasp.org/index.php/Testing_for_authentication)
* [Памятка OWASP: Аутентификация](https://www.owasp.org/index.php/Authentication_Cheat_Sheet)
* [Памятка OWASP: Утечка учётных данных](https://www.owasp.org/index.php/Credential_Stuffing_Prevention_Cheat_Sheet)
* [Памятка OWASP: Забытый пароль](https://www.owasp.org/index.php/Forgot_Password_Cheat_Sheet)
* [Памятка OWASP: Управление сессиями](https://www.owasp.org/index.php/Session_Management_Cheat_Sheet)
* [Справочник OWASP по автоматизированным атакам](https://www.owasp.org/index.php/OWASP_Automated_Threats_to_Web_Applications)

### Сторонние

* [NIST 800-63b: 5.1.1 Запоминаемые секреты](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecret)
* [CWE-287: Некорректная аутентификация](https://cwe.mitre.org/data/definitions/287.html)
* [CWE-384: Фиксация сессии](https://cwe.mitre.org/data/definitions/384.html)